{% extends "base.html" %}

{% block title %}Orders - SAMEERA RICE MILL{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Order Management</h2>
    <button class="btn" onclick="showAddForm()">Add New Order</button>
</div>

<div id="addForm" class="form-container" style="display:none;">
    <h3>Add Order</h3>
    <form onsubmit="addOrder(event)">
        <input type="text" id="customer_name" placeholder="Customer Name" required>
        <input type="text" id="product" placeholder="Product" required>
        <input type="number" id="quantity" placeholder="Quantity" step="0.01" required>
        <input type="number" id="total_price" placeholder="Total Price" step="0.01" required>
        <select id="status" required>
            <option value="Pending">Pending</option>
            <option value="Processing">Processing</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
        </select>
        <button type="submit" class="btn">Add Order</button>
        <button type="button" class="btn btn-secondary" onclick="hideAddForm()">Cancel</button>
    </form>
</div>

<div class="table-container">
    <table id="ordersTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Total Price</th>
                <th>Status</th>
                <th>Order Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="ordersBody">
        </tbody>
    </table>
</div>

<script>
function showAddForm() {
    document.getElementById('addForm').style.display = 'block';
}

function hideAddForm() {
    document.getElementById('addForm').style.display = 'none';
}

async function loadOrders() {
    try {
        const response = await fetch('/api/orders');
        const data = await response.json();
        const tbody = document.getElementById('ordersBody');
        const rows = data.map(order => `
            <tr>
                <td>${order.id}</td>
                <td>${order.customer_name}</td>
                <td>${order.product}</td>
                <td>${order.quantity}</td>
                <td>$${order.total_price.toFixed(2)}</td>
                <td><span class="status-${order.status.toLowerCase()}">${order.status}</span></td>
                <td>${order.order_date}</td>
                <td>
                    <button class="btn btn-small" onclick="deleteOrder(${order.id})">Delete</button>
                </td>
            </tr>
        `).join('');
        tbody.innerHTML = rows;
    } catch (error) {
        console.error('Error loading orders:', error);
    }
}

async function addOrder(event) {
    event.preventDefault();
    const data = {
        customer_name: document.getElementById('customer_name').value,
        product: document.getElementById('product').value,
        quantity: parseFloat(document.getElementById('quantity').value),
        total_price: parseFloat(document.getElementById('total_price').value),
        status: document.getElementById('status').value
    };
    
    try {
        const response = await fetch('/api/orders', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        if (response.ok) {
            hideAddForm();
            document.querySelector('form').reset();
            loadOrders();
        }
    } catch (error) {
        console.error('Error adding order:', error);
    }
}

async function deleteOrder(id) {
    if (confirm('Are you sure you want to delete this order?')) {
        try {
            const response = await fetch(`/api/orders/${id}`, {method: 'DELETE'});
            if (response.ok) {
                loadOrders();
            }
        } catch (error) {
            console.error('Error deleting order:', error);
        }
    }
}

loadOrders();
</script>
{% endblock %}
